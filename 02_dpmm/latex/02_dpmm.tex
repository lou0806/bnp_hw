% To compile: pdflatex file.tex
\documentclass{article}
\usepackage{fullpage}
\usepackage{pgffor}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{verbatim}
\usepackage{appendix}
\usepackage{graphicx}
\usepackage{color}
\usepackage{url} % for underscore in footnote
\usepackage[UKenglish]{isodate} % for: \today
\cleanlookdateon                % for: \today
%\pagestyle{empty} % Removes page number. Graphs too big.

\def\wl{\par \vspace{\baselineskip}\noindent}
\def\beginmyfig{\begin{figure}[htbp]\begin{center}}
\def\endmyfig{\end{center}\end{figure}}
\def\prodl{\prod\limits_{j=1}^{n^*}}
\def\suml{\sum\limits_{i=1}^n}
\def\ds{\displaystyle}
\def\tu{\textunderscore}
\definecolor{grey}{rgb}{.2,.2,.2}
\definecolor{lgrey}{rgb}{.8,.8,.8}
\def\hline{ \textcolor{lgrey}{\hrulefill} }
\newcommand{\m}[1]{\mathbf{\bm{#1}}} % Serif bold math

% \def for THIS ASSIGNMENT!!!%%%%%%%%%%%%%%%%%%%
\def \ip{{i^\prime}}
\def \tmi{ \{ \theta_\ip : \ip \neq i\} }
\def \stmi{ \m{\theta}_{-i} }

\def \tv{ \{ \theta_i : i = 1,...,n\} }
\def \stv{ \m{\theta} }

\def \tu{ \{ \theta_j^* : i = 1,...,n^*\} }
\def \stu{ \m{\theta^*} }

\def \y {\m{y}}

\begin{document}
% my title:
\begin{center}
  {\huge \textbf{Dirichlet Process Mixture Models}
    \footnote{\url{https://github.com/luiarthur/bnp_hw/02_dp_priors}}
  }\\
  \wl
  UCSC AMS 241 Homework 2\\
  \noindent\today\\
  Arthur Lui\\
  \hline
\end{center}

\section{Location Normal DP Mixed Model}

\subsection{P\'olya urn based Gibbs sampler}
\def\denom{ \alpha q_0 + \sum_{j=1}^{n^{*-}}n_j^- q_j }
Below is P\'olya urn based Gibbs sampler.
I will use the following notation for convenience: $\stv = \tv$, $\stmi = \tmi$, and $\stu = \tu$.
\[
    p(\theta_i | \stmi, \alpha, \phi, \mu, \tau^2, y_i) = 
    \ds\frac{\alpha q_0}{\denom} h(\theta_i| \psi, \phi, y_i) + 
    \ds\sum_{j=1}^{n^{*-}}\frac{ n_j^- q_j }{\denom} \delta_{\theta_j^{*-}}(\theta_i)
\]
where 
\begin{itemize}
  \item $q_j = k(y_i | \theta_j^{*-},\phi)$, the Normal density with mean and variance $\theta_j^{*-}$ and $\phi$ 
    evaluated at $y_i$.
  \item $q_0 = \ds\int k(y_i | \theta, \phi) g_0(\theta | \mu, \tau^2) d\theta
    = k(y_i~|~\mu,~\tau^2 + \phi)$
  \item $h(\theta_i| \psi, \phi, y_i) = c \cdot k(y_i | \theta_i, \phi) g_0(\theta_i | \mu, \tau^2)
    = k\left(\theta_i~\biggr|~\ds \frac{y_i\tau^2 + \mu\phi}{\tau^2+\phi},
    \ds\frac{\tau^2\phi}{\tau^2 + \phi} \right)$, where $c$ is a constant.
  \item $g_0$, is the density of $G_0$ and is $k(\theta | \mu, \tau^2)$.
\end{itemize}


\subsection{Model \& Prior Specification}
The hierearchical version of the DP mixture model of interest is 
\[
\begin{array}{rclcll}
  y_i &|& \theta_i,\phi &\overset{ind.}{\sim}& \text{N}(\theta_i, \phi), & i = 1,...,n\\
  \theta_i &|& G &\overset{i.i.d.}{\sim}&  G, & i = 1,...,n\\
  G &|& \alpha, \mu, \tau^2 &\sim& \text{DP}(\alpha, G_0=\text{N}(\mu,\tau^2))\\
    && \phi &\sim& \Gamma^{-1}(a_\phi,b_\phi) \\
    && \alpha &\sim& \Gamma(a_\alpha,b_\alpha) \\
    && \mu &\sim& \text{N}(a_\mu,b_\mu) \\
    && \tau^2 &\sim& \Gamma^{-1}(a_{\tau^2},b_{\tau^2}).\\
\end{array}
\]
where $\Gamma^{-1}(a,b)$ denotes the inverse-Gamma distribution with the associated density 
$f(x) = \ds \frac{b^a}{\Gamma(a)} x^{-a-1} \exp\left(\frac{-b}{x}\right)$, and we use the
shape and \emph{rate} parameterization for the Gamma distribution.

\noindent
We can write the complete conditions in closed form to be used in a Gibbs sampler as follows.
\[
\begin{array} {rclcl}
  \phi &|& \stv, \y &\sim& \Gamma^{-1}\left(\ds\frac{n}{2}+a_\phi,\frac{\suml (y_i-\theta_i)^2}{2} + b_\phi \right)\\
  \\
  \mu &|& \stu, n^*, \y &\sim& \text{N}\left(\ds \frac{(n^*\bar{\stu}) b_\mu + a_\mu\tau^2}{n^*b_\mu + \tau^2},
    \ds\frac{b_\mu \tau^2}{n^* b_\mu + \tau^2} \right)\\
  \\
  \tau^2 &|& \stu, n^*, \y &\sim& \Gamma^{-1}\left(\ds\frac{n^*}{2}+a_{\tau^2},
    \frac{\sum_{j=1}^{n^*} (\theta_j^*-\mu)^2}{2} + b_{\tau^2} \right)\\
  \eta &|& \alpha, \y &\sim& \text{Beta}(\alpha+1,n) \\
  p(\alpha &|& n^*, \y) &=& (\epsilon)~\gamma(\alpha | a_\alpha+n^*, b_\alpha-\log(\eta)) +
    (1-\epsilon)~\gamma(\alpha | a_\alpha+n^*-1, b_\alpha-\log(\eta))\\
\end{array}
\]
where $\gamma$ is the gamma density function with the mean and rate parameterization, 
$\epsilon = \ds\frac{a_\alpha +n^* - 1}{ n(b_\alpha-\log(\eta)) + a_\alpha +n^* -1}$,
and $\eta$ is an auxiliary variable introduced to make the prior for $\alpha$ conjugate. % In Lecture Notes 2.

\subsection{Posterior Sensitivity}
\subsection{Posterior Distribution for $\alpha$ and $n^*$}
\subsection{Clustering Induced by DP Mixture}
\subsection{Posterior Predictive}

\section{Location-Scale Normal DP Mixture Model}
\section{Poisson Regression}
\subsection{Simple Poisson Regression}
\subsection{Hierarchical Poisson Regression}
\subsection{DP Mixture-of-Poissons Regression}
%\beginmyfig
%  \includegraphics[scale=.6]{../code/pdfs/postMDP2.pdf}
%  \caption{Caption}
%\endmyfig

\end{document}

% To compile to html: 
% $ pandoc -s --mathjax -o hw2.html 02_dpmm.tex
% -o for output, -s for stand alone, --mathjax for mathjax
% For more details: http://pandoc.org/demos.html
